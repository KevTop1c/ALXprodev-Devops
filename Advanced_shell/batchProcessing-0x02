#!/bin/bash

# Pokémon Batch Data Retriever
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_BASE_URL="https://pokeapi.co/api/v2/pokemon/"
DELAY=2 
MAX_RETRIES=3

# Create directory for Pokémon data
mkdir -p pokemon_data

# Fetch data for each Pokémon
count=0
for pokemon in "${POKEMON_LIST[@]}"; do
    retry=0
    success=0
    
    while [ $retry -lt $MAX_RETRIES ] && [ $success -eq 0 ]; do
        echo "Fetching data for $pokemon... (Attempt $((retry + 1))/$MAX_RETRIES)"
        
        if curl -s --max-time 10 --fail "${API_BASE_URL}/${pokemon}" > "pokemon_data/${pokemon}.json"; then
            echo "Saved data to pokemon_data/${pokemon}.json ✅"
            success=1
        else
            echo "Attempt $((retry + 1)) failed for $pokemon"
            rm -f "pokemon_data/${pokemon}.json"
            retry=$((retry + 1))
            
            if [ $retry -lt $MAX_RETRIES ]; then
                echo "Retrying in ${DELAY}s..."
                sleep "$DELAY"
            fi
        fi
    done
    
    if [ $success -eq 0 ]; then
        echo "Failed to fetch $pokemon after $MAX_RETRIES attempts ❌"
    fi
    
    # Delay between different Pokémon
    count=$((count + 1))
    if [ $count -lt ${#POKEMON_LIST[@]} ]; then
        sleep "$DELAY"
    fi
done